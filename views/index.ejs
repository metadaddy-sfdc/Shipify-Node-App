<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="/stylesheets/Mobile-Design-Templates-master/common/css/app.min.css" />
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>
		<script src="/stylesheets/Mobile-Design-Templates-master/common/js/jquery.touchwipe.min.js" type="text/javascript" ></script>
		<script src="/stylesheets/Mobile-Design-Templates-master/common/js/main.min.js" type="text/javascript" ></script>
		
		<style>
          /* default S1 color styles */
            .list-view-header, .data-capture-buttons a {
                background: -webkit-linear-gradient(#2a93d5,#107abb);
                background: linear-gradient(#2a93d5,#107abb);
                box-shadow: 0 1px 3px rgba(0,0,0,.2),inset 0 1px 0 rgba(255,255,255,.21);
                color: white;
                font-weight: bold;
            }
        </style>
		<title></title>
	</head>
	<body>
		

	<!--	<b> GET INVOICE LIST</b>
			<br>
		<input type='button' value='Get Invoice List' onclick=getInvoices()></input> 
		<br>
		<br>
<br>
		<b> SHIP INVOICE </b>
				<br>
		Enter Invoice Name: <input id='invoice_name' style='width:600px' value=''></input>
		<br>
		Enter Invoice Id to Ship: <input id='invoice_id' style='width:600px' value=''></input>
		<br>
		Enter Invoice ParentId to Ship: <input id='parent_id' style='width:600px' value=''></input>
		<br>
		<input type='button' value='Ship Invoice' onclick=ship()></input>
		<hr>
		<b>Result:</b>
		<div style='height:500px;width:90%;overflow:auto' id='invoices'></div>-->

		<div id="invoicesListPage">
          <div class="list-view-header">Open Invoices</div>
          
          <ul id="openInvoices" class="list-view right-one-icons">
          </ul>
      </div> <!-- end invoicesListPage -->
      
      <div id="shipInvoicePage">
          <section class="opportunity-overview">
            <div class="content">
                <h2 id="accName" />
                <h1 id="invTotal"/>
            </div>
          </section>
          <section class="data-capture-buttons one-buttons">
              <div class="content">
                  <section class="data-capture-buttons one-buttons">
                      <a href="#" id="shipIt" onClick="ship()" >ship it</a>
                  </section>
               </div>
          </section>
      </div> <!-- end shipInvoicePage -->

      <div id="shipped">
          <section class="opportunity-overview">
            <div class="content">
                <h1>Shipped!</h1>
                <h2 id="confirmMsg">
            </div>
          </section>
      </div> <!-- end shipped -->

    <div style="display:none;">
    	<br>
		access_token: <input id='access_token' style='width:800px;' value='<%= client.oauthToken %>'></input>
		<br>
		instance_url: <input id='instance_url' style='width:800px;' value='<%=client.instanceUrl %>'></input>
		<hr>
	</div>



		<script type="text/javascript">
		var invoice_id;
		var parentId;
		var invoice_name;

		$(document).ready(function(){
            $("#shipInvoicePage").hide();
            $("#shipped").hide();

            getInvoices();
        });

		function getInvoices() {
			$.ajax({
				url: "/invoices",
				headers: {
					'Authorization': $('#access_token').val(),
					'instance_url': $('#instance_url').val()
				}
			}).done(function(data, textStatus, jqXHR) {
				console.log(data.records);
				$("#openInvoices").empty();  
		        $.each(data.records , function(){
		            var invTotal = this.Invoice_Total__c;
		            var invId = this.Id;
		            var invName = this.Name;
		            var accName = this.Account__r.Name;
		            var accId = this.Account__c;
		             
		            var newLi = $('<li></li>');     
		            var newLink = $('<a href="#" class="content"><h2>'+accName+'</h2><p><strong>'+invTotal
		                         +'</strong>&nbsp;('+invName+')</p><div class="list-view-icons"><span class="icon-right-arrow">'
		                         +'&nbsp;</span></div></a>');

		            newLink.click(function(e) {
		                 e.preventDefault();
		                 $("#accName").text(accName);
		                 $("#invTotal").text(invTotal);  

		                 $("#shipInvoicePage").show();
		                 $("#invoicesListPage").hide();

		                 invoice_id = invId;
		                 invoice_name = invName;
		                 parentId = accId;
		            });
		                            
		            newLi.append(newLink);            
		            newLi.appendTo('#openInvoices');
		        });
			}).fail(function(jqXHR, textStatus, errorThrown) {
				alert(JSON.stringify(jqXHR));
			})
		}

		function ship() {
			$.ajax({
				type: 'POST',
				url: "/ship/" + invoice_id, //$('#invoice_id').val(),
				headers: {
					'Authorization': $('#access_token').val(),
					'instance_url': $('#instance_url').val()
				},
				data: {
					"ParentId": parentId, //$('#parent_id').val(),
					"Name": invoice_name
				}
			}).done(function(data, textStatus, jqXHR) {
				//$('#invoices').html(JSON.stringify(data));
				$("#confirmMsg").text(invoice_name + " is now closed");
				$('#shipInvoicePage').hide();
				$('#shipped').show();
			}).fail(function(jqXHR, textStatus, errorThrown) {
				$('#invoices').html(JSON.stringify(jqXHR));
			})
		}
		</script>
	</body>
</html>